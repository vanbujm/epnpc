# Migration `20191022103237-initial`

This migration has been generated by Jonathan Van Buren at 10/22/2019, 10:32:37 AM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "epnpc"."Ego" (
  "cog" integer NOT NULL DEFAULT 0 ,
  "id" text NOT NULL  ,
  "int" integer NOT NULL DEFAULT 0 ,
  "name" text NOT NULL DEFAULT '' ,
  "ref" integer NOT NULL DEFAULT 0 ,
  "sav" integer NOT NULL DEFAULT 0 ,
  "som" integer NOT NULL DEFAULT 0 ,
  "wil" integer NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."Ware" (
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."Skill" (
  "id" text NOT NULL  ,
  "linkedAptitude" text NOT NULL DEFAULT 'COG' ,
  "name" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."MorphTrait" (
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."Morph" (
  "avail" integer NOT NULL DEFAULT 0 ,
  "cost" integer NOT NULL DEFAULT 0 ,
  "dr" integer NOT NULL DEFAULT 0 ,
  "dur" integer NOT NULL DEFAULT 0 ,
  "flex" integer NOT NULL DEFAULT 0 ,
  "id" text NOT NULL  ,
  "insight" integer NOT NULL DEFAULT 0 ,
  "movementRate" text   ,
  "moxie" integer NOT NULL DEFAULT 0 ,
  "name" text NOT NULL DEFAULT '' ,
  "notes" text   ,
  "type" text NOT NULL DEFAULT 'Biomorph' ,
  "vigor" integer NOT NULL DEFAULT 0 ,
  "wt" integer NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."NonPlayerCharacter" (
  "cog" integer NOT NULL DEFAULT 0 ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "int" integer NOT NULL DEFAULT 0 ,
  "ref" integer NOT NULL DEFAULT 0 ,
  "sav" integer NOT NULL DEFAULT 0 ,
  "som" integer NOT NULL DEFAULT 0 ,
  "threatPool" integer NOT NULL DEFAULT 0 ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "wil" integer NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "epnpc"."_MorphToWare" (
  "A" text   REFERENCES "epnpc"."Morph"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "epnpc"."Ware"("id") ON DELETE CASCADE
);

CREATE TABLE "epnpc"."_MorphToMorphTrait" (
  "A" text   REFERENCES "epnpc"."Morph"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "epnpc"."MorphTrait"("id") ON DELETE CASCADE
);

ALTER TABLE "epnpc"."Skill" ADD COLUMN "ego" text   REFERENCES "epnpc"."Ego"("id") ON DELETE SET NULL,
ADD COLUMN "nonPlayerCharacter" text   REFERENCES "epnpc"."NonPlayerCharacter"("id") ON DELETE SET NULL;

ALTER TABLE "epnpc"."Morph" ADD COLUMN "nonPlayerCharacter" text   REFERENCES "epnpc"."NonPlayerCharacter"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "Ego.name" ON "epnpc"."Ego"("name")

CREATE UNIQUE INDEX "Ware.name" ON "epnpc"."Ware"("name")

CREATE UNIQUE INDEX "Skill.name" ON "epnpc"."Skill"("name")

CREATE UNIQUE INDEX "MorphTrait.name" ON "epnpc"."MorphTrait"("name")

CREATE UNIQUE INDEX "Morph.name" ON "epnpc"."Morph"("name")

CREATE UNIQUE INDEX "_MorphToWare_AB_unique" ON "epnpc"."_MorphToWare"("A","B")

CREATE UNIQUE INDEX "_MorphToMorphTrait_AB_unique" ON "epnpc"."_MorphToMorphTrait"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191022103237-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+generator photon {
+  provider = "photonjs"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = "postgresql://admin:admin@localhost:5432/postgres?schema=epnpc"
+}
+
+model Ego {
+  id    String  @default(cuid()) @id
+  name  String  @unique
+
+  cog Int
+  int Int
+  ref Int
+  sav Int
+  som Int
+  wil Int
+  skills Skill[]
+}
+
+model Ware {
+ id String @default(cuid()) @id
+
+ name String @unique
+ morphs Morph[]
+}
+
+enum Aptitude {
+ COG
+ INT
+ REF
+ SAV
+ SOM
+ WIL
+}
+
+model Skill {
+  id String @default(cuid()) @id
+
+  name String @unique
+  linkedAptitude Aptitude
+}
+
+enum MorphType {
+  Biomorph
+  Synthmorph
+  Infomorph
+}
+
+model MorphTrait {
+  id String @default(cuid()) @id
+  name String @unique
+  morphs Morph[]
+}
+
+model Morph {
+  id String @default(cuid()) @id
+  name String @unique
+
+  cost Int
+  avail Int
+  wt Int
+  dur Int
+  dr Int
+  insight Int
+  moxie Int
+  vigor Int
+  flex Int
+  movementRate String?
+  ware Ware[]
+  type MorphType
+  notes String?
+  traits MorphTrait[]
+}
+
+model NonPlayerCharacter {
+  id String @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  threatPool Int
+  cog Int
+  int Int
+  ref Int
+  sav Int
+  som Int
+  wil Int
+  skills Skill[]
+  morph Morph
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191022103237-initial)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191022103237-initial'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
